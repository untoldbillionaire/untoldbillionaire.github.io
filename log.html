<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign in</title>
  <style>
    .rotating {
      display: inline-block;
      transform-origin: 50% 50%;
      --rotation-duration: 3s;
      animation: spin var(--rotation-duration) linear infinite;
      will-change: transform;
      cursor: pointer;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @media (prefers-reduced-motion: single-animation) {
      .rotating { animation: none !important; }
    }
  </style>
</head>
<body>
  <center class="freezer">
    <img class="rotating" src="freezer.webp" alt="freezing sign" width="200px" height="200px">
    <h1>Freezing spun</h1>
  </center>

  <center>
    <!-- Sign In Form -->
    <form id="loginForm">
      Email:
      <input type="email" id="loginEmail" required><br><br>
      Password:
      <input type="password" id="loginPassword" required><br><br>
      <input type="submit" value="Sign In">
      <br><br>
      <a href="#">Forgot password</a>
    </form>

    <!-- Dashboard -->
    <div id="dashboard" style="display:none; margin-top:20px;">
      <h2>Welcome Back!</h2>
      <p><strong>Email:</strong> <span id="displayEmail"></span></p>
    </div>
  </center>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDWRSdDveag6AQIaCP4SR5X5caMyMiiktk",
      authDomain: "collection-abae0.firebaseapp.com",
      projectId: "collection-abae0",
      storageBucket: "collection-abae0.appspot.com",
      messagingSenderId: "721235736494",
      appId: "1:721235736494:web:8e81c5cf9cb633383cfa3f",
      measurementId: "G-ZCR2D4F94L"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // âœ… Sign In
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        document.getElementById("displayEmail").textContent = user.email;
        document.getElementById("dashboard").style.display = "block";

        // Redirect after login
        window.location.href = "untold.html";
      } catch (error) {
        alert("Error: " + error.message);
      }
    });


        // Hide login form if already signed in
        document.getElementById("loginForm").style.display = "none";

        // Show dashboard
        document.getElementById("displayEmail").textContent = user.email;
        document.getElementById("dashboard").style.display = "block";

        // Optional: redirect straight to home page
        window.location.href = "untold.html";
      } else {
        console.log("No user signed in");
        // Show login form if no session
        document.getElementById("loginForm").style.display = "block";
        document.getElementById("dashboard").style.display = "none";
      }
    });
  </script>
</body>
</html>
